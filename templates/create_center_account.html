<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุดุงุก ุญุณุงุจ ููุฑูุฒ ุชุนูููู - ุนูุงูููุง</title>
    <link rel="icon" href="static/Website.jpg">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="../static/css/create_center_account.css">
</head>

<body>
    <header>
        <div class="logo">
            <a href="ุงููููุน.html" style="text-decoration: none; color: inherit;">
                <img src="static/Website.jpg" alt="ุดุนุงุฑ ุงููููุน" height="50" width="50">
                <h1>ุนูุงูููุง</h1>
            </a>
        </div>
        <h2>ุงูุดุงุก ุญุณุงุจ ููุฑูุฒ ุชุนูููู</h2>
    </header>
    
    <div class="form-container">
        <form action="" method="post" id="centerForm">
            <div class="owner_name">
                <label for="owner_name">ุงุณู ุงููุงูู:</label>
                <input type="text" id="owner_name" name="owner_name" value="{{ owner_name|default('') }}" required>
            </div>
            
            <div class="center_name">
                <label for="center_name">ุงุณู ุงููุฑูุฒ ุงูุชุนูููู:</label>
                <input type="text" id="center_name" name="center_name" value="{{ center_name|default('') }}" required>
            </div>
            
            <div class="email">
                <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
                <div class="input-group">
                    <input type="text" id="email" name="email" value="{{ email|default('') }}" placeholder="ุฃุฏุฎู ุงูุจุฑูุฏ ุฃู ุงุณู ุงููุณุชุฎุฏู" required pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$|^[a-zA-Z0-9._%+-]+$" title="ุฃุฏุฎู ุจุฑูุฏูุง ุตุญูุญูุง ุฃู ุงุณู ูุณุชุฎุฏู">
                    <select name="domain" id="domain" required>
                        <option value="">ุงุฎุชุฑ ุงููุทุงู</option>
                        <option value="gmail.com" {% if domain == 'gmail.com' %}selected{% endif %}>@gmail.com</option>
                        <option value="outlook.com" {% if domain == 'outlook.com' %}selected{% endif %}>@outlook.com</option>
                        <option value="yahoo.com" {% if domain == 'yahoo.com' %}selected{% endif %}>@yahoo.com</option>
                        <option value="hotmail.com" {% if domain == 'hotmail.com' %}selected{% endif %}>@hotmail.com</option>
                    </select>
                </div>
                <small id="emailHelp" style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                    ๐ก ููููู ูุชุงุจุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงููุงู ูุณูุชู ุชุญุฏูุฏ ุงููุทุงู ุชููุงุฆูุงู
                </small>
            </div>
            
            <div id="password" class="password">
                <label for="passwordField">ูููุฉ ุงููุฑูุฑ:</label>
                <input type="password" name="password" id="passwordField" required minlength="25" maxlength="25" placeholder="ุงููุฑ ูุชูููุฏ ูููุฉ ูุฑูุฑ" pattern=".{25}" title="ูุฌุจ ุฃู ุชููู 25 ุญุฑููุง ุจุงูุถุจุท">
                <div id="passwordOptions" style="display: none; margin-top: 10px;">
                    <button type="button" onclick="generateNewPassword()">ุชูููุฏ ูููุฉ ูุฑูุฑ ุนุดูุงุฆูุฉ</button>
                </div>
            </div>
            
            <div class="confirm_password">
                <label for="confirmPasswordField">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ:</label>
                <input type="password" name="confirm_password" id="confirmPasswordField" value="{{ confirm_password|default('') }}" required minlength="25" maxlength="25">
            </div>
            
            <div class="center_address">
                <label for="center_address">ุนููุงู ุงููุฑูุฒ ุงูุชุนูููู:</label>
                <input type="text" id="center_address" name="center_address" value="{{ center_address|default('') }}" required>
                <button type="button" class="location-picker-btn" onclick="getLocation()">ุญุฏุฏ ุงููููุน</button>
            </div>
            
            <div id="map"></div>
            
            <div class="employee_accounts">
                <label for="employee_accounts">ุนุฏุฏ ุญุณุงุจุงุช ุงููุนูููู:</label>
                <input type="number" id="employee_accounts" name="employee_accounts" value="{{ employee_accounts|default(1) }}" required min="1">
            </div>
            
            <div class="employee_accounts">
                <label for="student_accounts">ุนุฏุฏ ุญุณุงุจุงุช ุงูุทูุงุจ:</label>
                <input type="number" id="student_accounts" name="student_accounts" value="{{ student_accounts|default(1) }}" required min="1">
            </div>
            
            <input type="submit" value="ุงุฑุณุงู">
        </form>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
        document.addEventListener('DOMContentLoaded', function() {
            // ุฅุถุงูุฉ ุชุฃุซูุฑุงุช ููุญููู
            const inputs = document.querySelectorAll('input[type="text"], input[type="password"], input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'scale(1.02)';
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'scale(1)';
                });
            });
            
            // ุงููุดู ุงูุชููุงุฆู ุนู ุงููุทุงู
            const emailInput = document.getElementById('email');
            const domainSelect = document.getElementById('domain');
            const emailHelp = document.getElementById('emailHelp');
            
            emailInput.addEventListener('input', function() {
                const emailValue = this.value;
                
                // ุงูุชุญูู ูู ูุฌูุฏ @ ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
                if (emailValue.includes('@')) {
                    const parts = emailValue.split('@');
                    if (parts.length === 2) {
                        const domain = parts[1];
                        
                        // ุงูุชุญูู ูู ุงููุทุงูุงุช ุงููุฏุนููุฉ
                        const supportedDomains = ['gmail.com', 'outlook.com', 'yahoo.com', 'hotmail.com'];
                        
                        if (supportedDomains.includes(domain)) {
                            // ุชุญุฏูุฏ ุงููุทุงู ุชููุงุฆูุงู
                            domainSelect.value = domain;
                            
                            // ุฅุฒุงูุฉ ุงููุทุงู ูู ุญูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
                            this.value = parts[0];
                            
                            // ุฅุถุงูุฉ ุชุฃุซูุฑ ุจุตุฑู
                            domainSelect.style.backgroundColor = '#d4edda';
                            emailHelp.textContent = 'โ ุชู ุชุญุฏูุฏ ุงููุทุงู ุชููุงุฆูุงู: ' + domain;
                            emailHelp.style.color = '#28a745';
                            
                            setTimeout(() => {
                                domainSelect.style.backgroundColor = '';
                                emailHelp.textContent = '๐ก ููููู ูุชุงุจุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงููุงู ูุณูุชู ุชุญุฏูุฏ ุงููุทุงู ุชููุงุฆูุงู';
                                emailHelp.style.color = '#666';
                            }, 2000);
                        } else {
                            // ูุทุงู ุบูุฑ ูุฏุนูู
                            emailHelp.textContent = 'โ๏ธ ุงููุทุงู ุบูุฑ ูุฏุนูู. ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุทุงู ูู ุงููุงุฆูุฉ';
                            emailHelp.style.color = '#dc3545';
                            
                            setTimeout(() => {
                                emailHelp.textContent = '๐ก ููููู ูุชุงุจุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงููุงู ูุณูุชู ุชุญุฏูุฏ ุงููุทุงู ุชููุงุฆูุงู';
                                emailHelp.style.color = '#666';
                            }, 3000);
                        }
                    }
                } else {
                    // ุฅุนุงุฏุฉ ุชุนููู ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ
                    emailHelp.textContent = '๐ก ููููู ูุชุงุจุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงููุงู ูุณูุชู ุชุญุฏูุฏ ุงููุทุงู ุชููุงุฆูุงู';
                    emailHelp.style.color = '#666';
                }
            });
            
            // ุชุญุณูู ุชุฌุฑุจุฉ ูููุฉ ุงููุฑูุฑ
            const passwordField = document.getElementById('passwordField');
            const confirmPasswordField = document.getElementById('confirmPasswordField');
            
            passwordField.addEventListener('focus', function() {
                document.getElementById('passwordOptions').style.display = 'block';
            });
            
            // ุงูุชุญูู ูู ุชุทุงุจู ูููุงุช ุงููุฑูุฑ
            function checkPasswordMatch() {
                const password = passwordField.value;
                const confirmPassword = confirmPasswordField.value;
                
                if (confirmPassword && password !== confirmPassword) {
                    confirmPasswordField.setCustomValidity('ูููุงุช ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ');
                } else {
                    confirmPasswordField.setCustomValidity('');
                }
            }
            
            passwordField.addEventListener('input', checkPasswordMatch);
            confirmPasswordField.addEventListener('input', checkPasswordMatch);
        });

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
                document.getElementById('map').style.display = 'block';
            } else {
                alert("ุงููููุน ุงูุฌุบุฑุงูู ุบูุฑ ูุฏุนูู ูู ูุฐุง ุงููุชุตูุญ");
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const map = L.map('map').setView([lat, lng], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.marker([lat, lng]).addTo(map)
                .bindPopup('ูููุน ุงููุฑูุฒ')
                .openPopup();
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('center_address').value = data.display_name;
                });
        }

        function showError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    alert("ุงูุฑุฌุงุก ุงูุณูุงุญ ุจุงุณุชุฎุฏุงู ุงููููุน ุงูุฌุบุฑุงูู");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("ูุนูููุงุช ุงููููุน ุบูุฑ ูุชุงุญุฉ");
                    break;
                case error.TIMEOUT:
                    alert("ุทูุจ ุงููููุน ุงุณุชุบุฑู ููุชุงู ุทูููุงู");
                    break;
            }
        }

        function generateNewPassword() {
            const chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+{}[]:;<>,.?/';
            let password = '';
            for (let i = 0; i < 25; i++) {
                password += chars[Math.floor(Math.random() * chars.length)];
            }
            document.getElementById('passwordField').value = password;
            document.getElementById('confirmPasswordField').value = password;
            
            // ุฅุถุงูุฉ ุชุฃุซูุฑ ุจุตุฑู
            const passwordField = document.getElementById('passwordField');
            passwordField.style.backgroundColor = '#d4edda';
            setTimeout(() => {
                passwordField.style.backgroundColor = '';
            }, 1000);
        }
    </script>
</body>
</html>
